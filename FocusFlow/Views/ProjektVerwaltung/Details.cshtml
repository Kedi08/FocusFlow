@model FocusFlow.Models.Projekt

@{
    ViewBag.Title = "Projektübersicht";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>@Model.Titel</h2>
        <a href="@Url.Action("Edit", "ProjektVerwaltung", new { id = Model.ProjektId })" class="btn btn-primary">✏ Projekt bearbeiten</a>
    </div>

    <!-- Allgemeine Projektinformationen -->
    <div class="card mb-4 shadow-lg">
        <div class="card-header bg-primary text-white">
            <strong>Allgemeine Informationen</strong>
        </div>
        <div class="card-body">
            <p><strong>Beschreibung:</strong> @Model.Beschreibung</p>
            <p><strong>Projektleiter:</strong> @(Model.Projektleiter != null ? $"{Model.Projektleiter.Vorname} {Model.Projektleiter.Nachname}" : "Kein Projektleiter zugeordnet")</p>
            <p><strong>Status:</strong> <span class="badge bg-info text-dark">@Model.Status</span></p>
            <p><strong>Fortschritt:</strong> <span class="badge bg-success">@Model.Fortschritt %</span></p>

            <!-- Projektdokumente (nun in den allgemeinen Informationen) -->
            <h6 class="mt-3">Projektdokumente</h6>
            <a href="@Url.Action("Create", "Dokumente", new { parentId = Model.ProjektId, parentType = "Projekt" })" class="btn btn-success btn-sm mb-2">📄 Dokument hinzufügen</a>
            @if (Model.Dokumente != null && Model.Dokumente.Any())
            {
                <ul class="list-group">
                    @foreach (var doc in Model.Dokumente)
                    {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><strong>@doc.Name</strong> (@doc.Typ)</span>
                            <div>
                                <a href="@Url.Action("Edit", "Dokumente", new { id = doc.DokumentId })" class="btn btn-sm btn-secondary">✏ Bearbeiten</a>
                                <a href="@Url.Action("Delete", "Dokumente", new { id = doc.DokumentId })" class="btn btn-sm btn-danger">🗑 Löschen</a>
                            </div>
                        </li>
                    }
                </ul>
            }
            else
            {
                <p class="text-muted">Keine Projektdokumente vorhanden.</p>
            }
        </div>
    </div>

    <!-- Vorgehensmodell & Projektphasen -->
    @if (Model.Vorgehensmodell != null)
    {
        <div class="card mb-4 shadow-lg">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <strong>Vorgehensmodell: @Model.Vorgehensmodell.Name</strong>
                <a href="@Url.Action("Edit", "VorgehensmodellVerwaltung", new { id = Model.Vorgehensmodell.VorgehensmodellId })" class="btn btn-light btn-sm">✏ Bearbeiten</a>
            </div>
            <div class="card-body">
                <h5 class="mb-3">Projektphasen</h5>
                <a href="@Url.Action("Create", "ProjektphaseVerwaltung", new { vorgehensmodellId = Model.Vorgehensmodell.VorgehensmodellId })" class="btn btn-success btn-sm mb-2">+ Neue Phase hinzufügen</a>
                @if (Model.Vorgehensmodell.Projektphasen != null && Model.Vorgehensmodell.Projektphasen.Any())
                {
                    @foreach (var phase in Model.Vorgehensmodell.Projektphasen)
                    {
                        <div class="card mb-3">
                            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <strong>@phase.ProjektphaseName</strong>
                                <div>
                                    <a href="@Url.Action("Edit", "ProjektphaseVerwaltung", new { id = phase.ProjektphaseId })" class="btn btn-primary btn-sm">✏ Bearbeiten</a>
                                    <a href="@Url.Action("Delete", "ProjektphaseVerwaltung", new { id = phase.ProjektphaseId })" class="btn btn-danger btn-sm">🗑 Löschen</a>
                                </div>
                            </div>
                            <div class="card-body">
                                <p><strong>Fortschritt:</strong> <span class="badge bg-success">@phase.Fortschritt %</span></p>

                                <!-- Dokumente der Projektphase -->
                                <h6>Dokumente</h6>
                                <a href="@Url.Action("Create", "Dokumente", new { parentId = phase.ProjektphaseId, parentType = "Projektphase" })" class="btn btn-success btn-sm mb-2">📄 Hinzufügen</a>
                                @if (phase.Dokumente != null && phase.Dokumente.Any())
                                {
                                    <ul class="list-group">
                                        @foreach (var doc in phase.Dokumente)
                                        {
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                <span><strong>@doc.Name</strong> (@doc.Typ)</span>
                                                <div>
                                                    <a href="@Url.Action("Edit", "Dokumente", new { id = doc.DokumentId })" class="btn btn-sm btn-secondary">✏ Bearbeiten</a>
                                                    <a href="@Url.Action("Delete", "Dokumente", new { id = doc.DokumentId })" class="btn btn-sm btn-danger">🗑 Löschen</a>
                                                </div>
                                            </li>
                                        }
                                    </ul>
                                }
                                else
                                {
                                    <p class="text-muted">Keine Dokumente vorhanden.</p>
                                }

                                <!-- Aktivitäten & Ressourcen -->
                                <h6>Personelle Ressourcen</h6>
                                <a href="@Url.Action("Create", "PersonelleRessource", new { projektId = Model.ProjektId })" class="btn btn-success btn-sm mb-2">+ Ressource hinzufügen</a>
                                <p class="text-muted">Noch keine Ressourcen vorhanden.</p>

                                <h6>Externe Kosten</h6>
                                <a href="@Url.Action("Create", "ExterneKosten", new { projektId = Model.ProjektId })" class="btn btn-success btn-sm mb-2">+ Kosten hinzufügen</a>
                                <p class="text-muted">Noch keine externen Kosten vorhanden.</p>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>
    }
</div>
